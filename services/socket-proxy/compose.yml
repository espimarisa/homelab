services:
  ###########################################################################
  # Socket Proxy: Proxy wrapper for the Docker socket for secure access.    #
  ###########################################################################

  socket-proxy:
    image: ghcr.io/11notes/socket-proxy:2.1.4
    container_name: socket-proxy
    env_file: ../../.env
    hostname: socket-proxy
    read_only: true
    user: "0:${DOCKER_GID}"
    restart: unless-stopped
    environment:
      TZ: "${TZ}"
    networks:
      - socket-proxy
    volumes:
      - /var/run/docker.sock:/run/docker.sock:ro
      - socket-proxy:/run/proxy
    cap_drop:
      - AUDIT_WRITE
      - MKNOD
      - SETFCAP
      - SYS_ADMIN
      - SYS_CHROOT
      - SYS_PTRACE
    deploy:
      resources:
        limits:
          cpus: "0.10"
          memory: 64M
        reservations:
          cpus: "0.05"
          memory: 32M
    security_opt:
      - no-new-privileges:true
