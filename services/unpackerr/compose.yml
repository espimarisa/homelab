services:
  ###########################################################################
  # Unpackerr: Auto-extract compressed downloads - https://unpackerr.zip    #
  ###########################################################################

  unpackerr:
    image: ghcr.io/unpackerr/unpackerr:0.14.5
    container_name: unpackerr
    hostname: unpackerr
    read_only: true
    restart: unless-stopped
    user: ${PUID}:${PGID}
    environment:
      TZ: "${TZ}"
      UMASK: "${UMASK}"
      UN_INTERVAL: "5m"
      UN_LOG_FILE: "/downloads/unpackerr.log"
      UN_PARALLEL: "1"
      UN_RADARR_0_API_KEY: "${RADARR_API_KEY}"
      UN_RADARR_0_URL: "http://radarr:7878"
      UN_SONARR_0_API_KEY: "${SONARR_API_KEY}"
      UN_SONARR_0_URL: "http://sonarr:8989"
    networks:
      - gluetun
    tmpfs:
      - "/tmp:uid=${PUID},gid=${PGID}"
    volumes:
      - downloads:/downloads
    cap_add:
      - CHOWN
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: 2
          memory: 1024M
    security_opt:
      - no-new-privileges:true

networks:
  gluetun:
    driver: bridge
    external: true
    ipam:
      config:
        - subnet: 172.19.0.0/16
          gateway: 172.19.0.1
    name: gluetun-network

volumes:
  downloads:
    name: downloads-bind
    driver_opts:
      device: "${DOWNLOADS_PATH}"
      o: bind
      type: none
  media-library:
    name: media-library-bind
    driver_opts:
      device: "${MEDIA_LIBRARY_PATH}"
      o: bind
      type: none
